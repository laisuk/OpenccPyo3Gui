<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product
    Name="OpenccPyo3Gui"
    Manufacturer="Laisuk@2026"
    Id="*"
    UpgradeCode="a864bbc0-9a92-435b-941b-32b8d9737ae7"
    Language="1033"
    Version="$(var.AppVersion)">

    <Package InstallerVersion="500" Compressed="yes" InstallScope="perMachine" Platform="x64" />

    <MajorUpgrade
      AllowDowngrades="no"
      DowngradeErrorMessage="A newer version of OpenccPyo3Gui is already installed." />
    <MediaTemplate EmbedCab="yes" CompressionLevel="high" />

    <!-- Directories -->
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFiles64Folder">
        <Directory Id="INSTALLFOLDER" Name="OpenccPyo3Gui" />
      </Directory>
      <Directory Id="ProgramMenuFolder">
        <Directory Id="AppProgramMenuDir" Name="OpenccPyo3Gui" />
      </Directory>
      <Directory Id="DesktopFolder" />
    </Directory>

    <!-- Feature -->
    <Feature Id="MainFeature" Title="OpenccPyo3Gui" Level="1" Absent="disallow" ConfigurableDirectory="INSTALLFOLDER">
      <!-- All harvested app files -->
      <ComponentGroupRef Id="AppFiles" />
      <!-- Shortcuts -->
      <ComponentRef Id="ApplicationShortcutStartMenu" />
      <ComponentRef Id="ApplicationShortcutDesktop" />
    </Feature>

    <!-- Non-advertised shortcuts must be in HKCU-keyed components with NO file elements -->

    <!-- Start Menu shortcut component -->
    <DirectoryRef Id="AppProgramMenuDir">
      <Component Id="ApplicationShortcutStartMenu" Guid="f4cf2762-8fe2-4521-8614-0f0c8fef079a">
        <!-- HKCU KeyPath satisfies ICE43/ICE57 -->
        <RegistryValue Root="HKCU"
                       Key="Software\OpenccPyo3Gui"
                       Name="StartMenuShortcutInstalled"
                       Type="integer"
                       Value="1"
                       KeyPath="yes" />
        <Shortcut Id="StartMenuShortcut"
                  Directory="AppProgramMenuDir"
                  Name="OpenccPyo3Gui"
                  WorkingDirectory="INSTALLFOLDER"
                  Target="[INSTALLFOLDER]OpenccPyo3Gui.exe"
                  Icon="AppIcon.ico" />
        <RemoveFolder Id="RemoveAppProgramMenuDir" Directory="AppProgramMenuDir" On="uninstall" />
      </Component>
    </DirectoryRef>

    <!-- Desktop shortcut component -->
    <DirectoryRef Id="DesktopFolder">
      <Component Id="ApplicationShortcutDesktop" Guid="c1a027dd-d2d1-449f-84c6-5c195a930933">
        <!-- HKCU KeyPath -->
        <RegistryValue Root="HKCU"
                       Key="Software\OpenccPyo3Gui"
                       Name="DesktopShortcutInstalled"
                       Type="integer"
                       Value="1"
                       KeyPath="yes" />
        <Shortcut Id="DesktopShortcut"
                  Directory="DesktopFolder"
                  Name="OpenccPyo3Gui"
                  WorkingDirectory="INSTALLFOLDER"
                  Target="[INSTALLFOLDER]OpenccPyo3Gui.exe"
                  Icon="AppIcon.ico" />
      </Component>
    </DirectoryRef>

    <!-- ARP icon / shortcuts icon (ensure this .ico exists in your .dist) -->
<!--     <Icon Id="AppIcon.ico" SourceFile="$(var.SourceDir)\openccpyo3gui.ico" /> -->
    <Icon Id="AppIcon.ico" SourceFile="assets\openccpyo3gui.ico" />
    <Property Id="ARPPRODUCTICON" Value="AppIcon.ico" />

    <!-- Let user choose install directory -->
    <UIRef Id="WixUI_InstallDir" />
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />

  </Product>
</Wix>
